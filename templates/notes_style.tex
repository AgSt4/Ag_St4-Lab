% Plantilla para Notas UC - Compatible con Quarto
% Creada por Ag_St4

\usepackage{fancyhdr, ragged2e, titlesec, graphicx, enumitem, multicol, pgfplots, subcaption, hyperref, cancel, listings, float, amsmath, adjustbox, parskip, amssymb, tikz, fontspec, unicode-math, multirow, booktabs}
\usepackage[dvipsnames]{xcolor}
\pgfplotsset{compat=1.17}
\usepackage[most]{tcolorbox}
\usetikzlibrary{automata, positioning, shapes, babel}
\usepackage[spanish]{babel}

\tcbuselibrary{breakable}

% Configuración de fuentes
\setmainfont{Lato}[
  Extension = .ttf,
  UprightFont = *-Regular,
  BoldFont = *-Bold,
  ItalicFont = *-Italic,
  BoldItalicFont = *-BoldItalic,
  Path = /usr/share/fonts/truetype/lato/,
  FallBack = Latin Modern Roman
]
\setmathfont{STIX Two Math}[
  FallBack = Latin Modern Math
]

\justifying

% Placeholders para variables del documento
\providecommand{\myCourse}{Curso por Definir}
\providecommand{\mySemester}{Semestre por Definir}
\providecommand{\myEmail}{email@uc.cl}

% Definición del Encabezado
\setlength{\headheight}{0.5in}
\pagestyle{fancy}
\fancyhead[C]{%
    \begin{minipage}{0.9\textwidth}
        \RaggedRight
        \textit{Pontificia Universidad Católica de Chile} \\
        \textit{Facultad de Ciencias Económicas y Administrativas}
    \end{minipage}}
\fancyhead[L]{%
    \begin{minipage}{0.1\textwidth}
        \includegraphics[width=0.75cm]{../../../../templates/Logo_UC.png}
    \end{minipage}}
\fancyhead[R]{%
    \begin{minipage}{0.5\textwidth}
        \raggedleft
        \textit{\myCourse} \\
        \textit{\mySemester}
    \end{minipage}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\headruleskip}{1.5pt}

% Definir el entorno "respuesta"
\newtcolorbox[auto counter, number within=subsection]{respuesta}{%
    breakable,
    colbacktitle=black!60,
    colframe=black!60,
    colback=black!5,
    coltitle=white,
    fonttitle=\itshape,
    title={Respuesta a la Pregunta \thesubsection},
    arc=5pt,
    sharp corners = downhill,
    before upper=\setlength{\parskip}{5pt}
}

% Caja para destacar
\newtcbox{\mybox}[1][red]{on line, arc=0pt, outer arc=0pt, colback=#1!10!white, colframe=#1!50!black, boxsep=0pt, left=1pt, right=1pt, top=2pt, bottom=2pt, boxrule=0pt, bottomrule=1pt, toprule=1pt}

% Definición de colores para código
\definecolor{codeblue}{RGB}{0,0,255}
\definecolor{codegreen}{RGB}{0,128,0}
\definecolor{codecrimson}{RGB}{220,20,60}

% Configuración de listings
\lstset{%
    frame=tb,
    backgroundcolor=\color{white},
    aboveskip=3mm,
    belowskip=3mm,
    showstringspaces=false,
    columns=flexible,
    basicstyle={\ttfamily},
    numbers=left,
    numberstyle=\color{gray},
    numbersep=5pt,
    keywordstyle=\color{codeblue},
    commentstyle=\color{codegreen},
    stringstyle=\color{codecrimson},
    breaklines=true,
    breakatwhitespace=true,
    tabsize=4,
    framexleftmargin = -5pt,
    rulesepcolor =\color{codeblue},
    frame=shadowbox,
    framesep=4pt,
    framerule=0.2pt
}

% Formatos de sección
\titleformat{\section}
  {\normalfont\Large\bfseries\color{RoyalBlue}}
  {\thesection}
  {1em}
  {}

\titleformat{\subsection}
  {\normalfont\normalsize\bfseries\color{RoyalPurple}}
  {\thesubsection}
  {1em}
  {}

\titleformat{\subsubsection}
  {\normalfont\normalsize\itshape\color{Periwinkle}}
  {\thesubsubsection}
  {1em}
  {}

% Redefinir \maketitle para formato personalizado
\makeatletter
\renewcommand{\maketitle}{%
  \begin{center}
    {\LARGE \textit{\textbf{Notas:} \@title}}\\[3mm]
    
    \rule{0.8\linewidth}{0.4pt}\\[3mm]
    
    \begin{tabular}{l l l}
        \textbf{Autor:}& \@author &\href{mailto:\myEmail}{\myEmail} \\[2mm]
        \textbf{Fecha:}& \@date \\[2mm]
    \end{tabular} \\[1mm]
    
    \rule{0.8\linewidth}{0.4pt}
  \end{center}
  \vspace{5mm}
}
\makeatother